



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="Cirrus CI is a modern Continuous Integration system built for the era of cloud computing. Cirrus CI supports both Linux and Windows environments as well as various cloud computing services like Kubernetes and Google Cloud Platform.
">
      
      
        <link rel="canonical" href="https://cirrus-ci.org/examples/">
      
      
        <meta name="author" content="Cirrus Labs">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../assets/images/favicon.ico">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.5.0">
    
    
      
        <title>Examples - Cirrus CI</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.1b62728e.css">
      
        <link rel="stylesheet" href="../assets/stylesheets/application-palette.a8b3c06d.css">
      
      
        
        
        <meta name="theme-color" content="#3f51b5">
      
    
    
      <script src="../assets/javascripts/modernizr.268332fc.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../assets/fonts/material-icons.css">
    
    
      <link rel="stylesheet" href="../stylesheets/extra.css">
    
    
      
        
<script>
  window.ga = window.ga || function() {
    (ga.q = ga.q || []).push(arguments)
  }
  ga.l = +new Date
  /* Setup integration and send page view */
  ga("create", "UA-110620457-1", "cirrus-ci.org")
  ga("set", "anonymizeIp", true)
  ga("send", "pageview")
  /* Register handler to log search on blur */
  document.addEventListener("DOMContentLoaded", () => {
    if (document.forms.search) {
      var query = document.forms.search.query
      query.addEventListener("blur", function() {
        if (this.value) {
          var path = document.location.pathname;
          ga("send", "pageview", path + "?q=" + this.value)
        }
      })
    }
  })
</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
      
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#examples" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="https://cirrus-ci.org" title="Cirrus CI" class="md-header-nav__button md-logo">
          
            <img src="../assets/images/logo.svg" width="24" height="24">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              Cirrus CI
            </span>
            <span class="md-header-nav__topic">
              
                Examples
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/cirruslabs/cirrus-ci-docs/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    GitHub
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
        

  

<nav class="md-tabs md-tabs--active" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  
    <li class="md-tabs__item">
      
        <a href=".." class="md-tabs__link">
          Home
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../features/" class="md-tabs__link">
          Features
        </a>
      
    </li>
  

      
        
  
  
    
    
  
  
    <li class="md-tabs__item">
      
        <a href="../guide/quick-start/" class="md-tabs__link">
          Documentation
        </a>
      
    </li>
  

  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="./" class="md-tabs__link md-tabs__link--active">
          Examples
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../pricing/" class="md-tabs__link">
          Pricing
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../support/" class="md-tabs__link">
          Support
        </a>
      
    </li>
  

      
    </ul>
  </div>
</nav>
      
      <main class="md-main" role="main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="https://cirrus-ci.org" title="Cirrus CI" class="md-nav__button md-logo">
      
        <img src="../assets/images/logo.svg" width="48" height="48">
      
    </a>
    Cirrus CI
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/cirruslabs/cirrus-ci-docs/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    
      <a href="/" title="Home" class="md-nav__link">
        Home
      </a>
    
  </li>

    
      
      
      


  <li class="md-nav__item">
    
      <a href="/features" title="Features" class="md-nav__link">
        Features
      </a>
    
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Documentation
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Documentation
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-1" type="checkbox" id="nav-3-1">
    
    <label class="md-nav__link" for="nav-3-1">
      User Guide
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-3-1">
        User Guide
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    
      <a href="/guide/quick-start/" title="Quick Start" class="md-nav__link">
        Quick Start
      </a>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    
      <a href="/guide/writing-tasks/" title="Writing Tasks" class="md-nav__link">
        Writing Tasks
      </a>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    
      <a href="/guide/tips-and-tricks/" title="Configuration Tips and Tricks" class="md-nav__link">
        Configuration Tips and Tricks
      </a>
    
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-1-4" type="checkbox" id="nav-3-1-4">
    
    <label class="md-nav__link" for="nav-3-1-4">
      Execution Environment
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-3-1-4">
        Execution Environment
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    
      <a href="/guide/linux/" title="Linux Containers" class="md-nav__link">
        Linux Containers
      </a>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    
      <a href="/guide/windows/" title="Windows Containers" class="md-nav__link">
        Windows Containers
      </a>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    
      <a href="/guide/macOS/" title="macOS VMs" class="md-nav__link">
        macOS VMs
      </a>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    
      <a href="/guide/FreeBSD/" title="FreeBSD VMs" class="md-nav__link">
        FreeBSD VMs
      </a>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    
      <a href="/guide/docker-builder-vm/" title="Docker Builder on VM" class="md-nav__link">
        Docker Builder on VM
      </a>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    
      <a href="/guide/docker-builds-on-kubernetes/" title="Docker Builds on GKE" class="md-nav__link">
        Docker Builds on GKE
      </a>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    
      <a href="/guide/docker-pipe/" title="Docker Pipe" class="md-nav__link">
        Docker Pipe
      </a>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    
      <a href="/guide/supported-computing-services/" title="Computing Services" class="md-nav__link">
        Computing Services
      </a>
    
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    
      <a href="/guide/build-life/" title="Life of a Build" class="md-nav__link">
        Life of a Build
      </a>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    
      <a href="/guide/notifications/" title="Notifications" class="md-nav__link">
        Notifications
      </a>
    
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    
      <a href="/api/" title="API" class="md-nav__link">
        API
      </a>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    
      <a href="/faq/" title="FAQ" class="md-nav__link">
        FAQ
      </a>
    
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-4" type="checkbox" id="nav-3-4">
    
    <label class="md-nav__link" for="nav-3-4">
      Legal
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-3-4">
        Legal
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    
      <a href="/legal/privacy/" title="Privacy" class="md-nav__link">
        Privacy
      </a>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    
      <a href="/legal/terms/" title="Terms of Service" class="md-nav__link">
        Terms of Service
      </a>
    
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    
      <a href="/security/" title="Security" class="md-nav__link">
        Security
      </a>
    
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
      <a href="/examples" title="Examples" class="md-nav__link">
        Examples
      </a>
    
  </li>

    
      
      
      


  <li class="md-nav__item">
    
      <a href="/pricing" title="Pricing" class="md-nav__link">
        Pricing
      </a>
    
  </li>

    
      
      
      


  <li class="md-nav__item">
    
      <a href="/support" title="Support" class="md-nav__link">
        Support
      </a>
    
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#android" class="md-nav__link">
    Android
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bazel" class="md-nav__link">
    Bazel
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#remote-cache" class="md-nav__link">
    Remote Cache
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#c" class="md-nav__link">
    C++
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#elixir" class="md-nav__link">
    Elixir
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#erlang" class="md-nav__link">
    Erlang
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#flutter" class="md-nav__link">
    Flutter
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#flutter-web" class="md-nav__link">
    Flutter Web
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#go" class="md-nav__link">
    Go
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#gradle" class="md-nav__link">
    Gradle
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#caching" class="md-nav__link">
    Caching
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#build-cache" class="md-nav__link">
    Build Cache
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#junit" class="md-nav__link">
    JUnit
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#maven" class="md-nav__link">
    Maven
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mysql" class="md-nav__link">
    MySQL
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#node" class="md-nav__link">
    Node
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#npm" class="md-nav__link">
    npm
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#yarn" class="md-nav__link">
    Yarn
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#python" class="md-nav__link">
    Python
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#building-pypi-packages" class="md-nav__link">
    Building PyPI Packages
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#linting" class="md-nav__link">
    Linting
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#unittest-annotations" class="md-nav__link">
    Unittest Annotations
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#release-assets" class="md-nav__link">
    Release Assets
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ruby" class="md-nav__link">
    Ruby
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rust" class="md-nav__link">
    Rust
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#rust-nightly" class="md-nav__link">
    Rust Nightly
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/cirruslabs/cirrus-ci-docs/blob/master/docs/examples.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="examples">Examples<a class="headerlink" href="#examples" title="Permanent link">&para;</a></h1>
<p>Here you can find example configurations per different programming languages/frameworks.</p>
<h2 id="android">Android<a class="headerlink" href="#android" title="Permanent link">&para;</a></h2>
<p>Cirrus CI has a <a href="https://hub.docker.com/r/cirrusci/android-sdk/">set of Docker images ready for Android development</a>. 
If these images are not the right fit for your project you can always use any custom Docker image with Cirrus CI. For those
images <code>.cirrus.yml</code> configuration file can look like:</p>
<div class="codehilite"><pre><span></span><span class="nt">container</span><span class="p">:</span>
  <span class="nt">image</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">cirrusci/android-sdk:27</span>

<span class="nt">check_android_task</span><span class="p">:</span>
  <span class="nt">check_script</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">./gradlew check connectedCheck</span>
</pre></div>

<p>Or like this if a running emulator is needed for the tests:</p>
<div class="codehilite"><pre><span></span><span class="nt">container</span><span class="p">:</span>
  <span class="nt">image</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">cirrusci/android-sdk:18</span>
  <span class="nt">cpu</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">4</span>
  <span class="nt">memory</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10G</span>

<span class="nt">check_android_task</span><span class="p">:</span>
  <span class="nt">create_device_script</span><span class="p">:</span>
    <span class="l l-Scalar l-Scalar-Plain">echo no | avdmanager create avd --force</span>
        <span class="l l-Scalar l-Scalar-Plain">-n test</span>
        <span class="l l-Scalar l-Scalar-Plain">-k &quot;system-images;android-18;default;armeabi-v7a&quot;</span>
  <span class="nt">start_emulator_background_script</span><span class="p">:</span>
    <span class="l l-Scalar l-Scalar-Plain">$ANDROID_HOME/emulator/emulator</span>
        <span class="l l-Scalar l-Scalar-Plain">-avd test</span>
        <span class="l l-Scalar l-Scalar-Plain">-no-audio</span>
        <span class="l l-Scalar l-Scalar-Plain">-no-window</span>
  <span class="nt">wait_for_emulator_script</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">adb wait-for-device</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">adb shell input keyevent 82</span>
  <span class="nt">check_script</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">./gradlew check connectedCheck</span>
</pre></div>

<div class="admonition info">
<p class="admonition-title">Info</p>
<p>Please don't forget to setup <a href="#build-cache">Remote Build Cache</a> for your Gradle project. Or at least <a href="#gradle-caching">simple folder caching</a>.</p>
</div>
<h2 id="bazel">Bazel<a class="headerlink" href="#bazel" title="Permanent link">&para;</a></h2>
<p>Bazel Team provides a <a href="https://l.gcr.io/google/bazel">set of official Docker images with Bazel pre-installed</a>. Here is
an example of how <code>.cirrus.yml</code> can look like for Bazel:</p>
<div class="codehilite"><pre><span></span><span class="nt">container</span><span class="p">:</span>
  <span class="nt">image</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">l.gcr.io/google/bazel:latest</span>
<span class="nt">task</span><span class="p">:</span>
  <span class="nt">build_script</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">bazel build //...</span>
</pre></div>

<p>If these images are not the right fit for your project you can always use any custom Docker image with Cirrus CI.</p>
<h3 id="remote-cache">Remote Cache<a class="headerlink" href="#remote-cache" title="Permanent link">&para;</a></h3>
<p>Cirrus CI has <a href="../guide/writing-tasks/#http-cache">built-in HTTP Cache</a> which is compatible with Bazel's <a href="https://github.com/bazelbuild/bazel/blob/master/src/main/java/com/google/devtools/build/lib/remote/README.md">remote cache</a>.</p>
<p>Here is an example of how Cirrus CI HTTP Cache can be used with Bazel:</p>
<div class="codehilite"><pre><span></span><span class="nt">container</span><span class="p">:</span>
  <span class="nt">image</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">l.gcr.io/google/bazel:latest</span>
<span class="nt">task</span><span class="p">:</span>
  <span class="nt">build_script</span><span class="p">:</span>
    <span class="l l-Scalar l-Scalar-Plain">bazel build</span>
      <span class="l l-Scalar l-Scalar-Plain">--spawn_strategy=sandboxed</span>
      <span class="l l-Scalar l-Scalar-Plain">--strategy=Javac=sandboxed</span>
      <span class="l l-Scalar l-Scalar-Plain">--genrule_strategy=sandboxed</span>
      <span class="l l-Scalar l-Scalar-Plain">--remote_http_cache=http://$CIRRUS_HTTP_CACHE_HOST</span>
      <span class="l l-Scalar l-Scalar-Plain">//...</span>
</pre></div>

<h2 id="c">C++<a class="headerlink" href="#c" title="Permanent link">&para;</a></h2>
<p>Official <a href="https://hub.docker.com/_/gcc/">GCC Docker images</a> can be used for builds. Here is an example of a <code>.cirrus.yml</code> that runs tests:</p>
<div class="codehilite"><pre><span></span><span class="nt">container</span><span class="p">:</span>
  <span class="nt">image</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">gcc:latest</span>
<span class="nt">task</span><span class="p">:</span>
  <span class="nt">tests_script</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">make tests</span>
</pre></div>

<h2 id="elixir">Elixir<a class="headerlink" href="#elixir" title="Permanent link">&para;</a></h2>
<p>Official <a href="https://hub.docker.com/_/elixir/">Elixir Docker images</a> can be used for builds. Here is an example of a <code>.cirrus.yml</code> that runs tests:</p>
<div class="codehilite"><pre><span></span><span class="nt">test_task</span><span class="p">:</span>
  <span class="nt">container</span><span class="p">:</span>
    <span class="nt">image</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">elixir:latest</span>
  <span class="nt">mix_cache</span><span class="p">:</span>
    <span class="nt">folder</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">deps</span>
    <span class="nt">fingerprint_script</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">cat mix.lock</span>
    <span class="nt">populate_script</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">mix deps.get</span>
  <span class="nt">compile_script</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">mix compile</span>
  <span class="nt">test_script</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">mix test</span>
</pre></div>

<h2 id="erlang">Erlang<a class="headerlink" href="#erlang" title="Permanent link">&para;</a></h2>
<p>Official <a href="https://hub.docker.com/_/erlang/">Erlang Docker images</a> can be used for builds. Here is an example of a <code>.cirrus.yml</code> that runs tests:</p>
<div class="codehilite"><pre><span></span><span class="nt">test_task</span><span class="p">:</span>
  <span class="nt">container</span><span class="p">:</span>
    <span class="nt">image</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">erlang:latest</span>
  <span class="nt">rebar3_cache</span><span class="p">:</span>
    <span class="nt">folder</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">_build</span>
    <span class="nt">fingerprint_script</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">cat rebar.lock</span>
    <span class="nt">populate_script</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">rebar3 compile --deps_only</span>
  <span class="nt">compile_script</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">rebar3 compile</span>
  <span class="nt">test_script</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">rebar3 ct</span>
</pre></div>

<h2 id="flutter">Flutter<a class="headerlink" href="#flutter" title="Permanent link">&para;</a></h2>
<p>Cirrus CI provides a <a href="https://hub.docker.com/r/cirrusci/flutter/">set of Docker images with Flutter and Dart SDK pre-installed</a>.
Here is an example of how <code>.cirrus.yml</code> can be written for Flutter:</p>
<div class="codehilite"><pre><span></span><span class="nt">container</span><span class="p">:</span>
  <span class="nt">image</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">cirrusci/flutter:latest</span>

<span class="nt">test_task</span><span class="p">:</span>
  <span class="nt">pub_cache</span><span class="p">:</span>
    <span class="nt">folder</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">~/.pub-cache</span>
  <span class="nt">test_script</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">flutter test</span>
</pre></div>

<p>If these images are not the right fit for your project you can always use any custom Docker image with Cirrus CI.</p>
<h3 id="flutter-web">Flutter Web<a class="headerlink" href="#flutter-web" title="Permanent link">&para;</a></h3>
<p><a href="https://hub.docker.com/r/cirrusci/flutter/">Our Docker images with Flutter and Dart SDK pre-installed</a> have special <code>*-web</code> tags
with <a href="https://www.chromium.org/">Chromium</a> pre-installed. You can use these tags to run Flutter Web </p>
<p>First define a new <code>chromium</code> platform in your <code>dart_test.yaml</code>:</p>
<div class="codehilite"><pre><span></span><span class="nt">define_platforms</span><span class="p">:</span>
  <span class="nt">chromium</span><span class="p">:</span>
    <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Chromium</span>
    <span class="nt">extends</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">chrome</span>
    <span class="nt">settings</span><span class="p">:</span>
      <span class="nt">arguments</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">--no-sandbox</span>
      <span class="nt">executable</span><span class="p">:</span>
        <span class="nt">linux</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">chromium</span>
</pre></div>

<p>Now you'll be able to run tests targeting web via <code>pub run test test -p chromium</code></p>
<h2 id="go">Go<a class="headerlink" href="#go" title="Permanent link">&para;</a></h2>
<p>The best way to test Go projects is by using <a href="https://hub.docker.com/_/golang/">official Go Docker images</a>. Here is
an example of how <code>.cirrus.yml</code> can look like for a project using Go Modules:</p>
<div class="codehilite"><pre><span></span><span class="nt">container</span><span class="p">:</span>
  <span class="nt">image</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">golang:latest</span>

<span class="nt">env</span><span class="p">:</span>
  <span class="nt">GOPROXY</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">https://proxy.golang.org</span>

<span class="nt">test_task</span><span class="p">:</span>
  <span class="nt">modules_cache</span><span class="p">:</span>
    <span class="nt">fingerprint_script</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">cat go.sum</span>
    <span class="nt">folder</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">$GOPATH/pkg/mod</span>
  <span class="nt">get_script</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">go get ./...</span>
  <span class="nt">build_script</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">go build ./...</span>
  <span class="nt">test_script</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">go test ./...</span>
</pre></div>

<h2 id="gradle">Gradle<a class="headerlink" href="#gradle" title="Permanent link">&para;</a></h2>
<p>We recommend use of the <a href="https://hub.docker.com/_/gradle/">official Gradle Docker containers</a> since they have Gradle specific configurations already set up. For example, standard Java containers don't have 
a pre-configured user and as a result don't have <code>HOME</code> environment variable presented which makes Gradle complain.</p>
<h3 id="caching">Caching<a class="headerlink" href="#caching" title="Permanent link">&para;</a></h3>
<p>To preserve caches between Gradle runs simply add a <a href="../guide/writing-tasks/#cache-instruction">cache instruction</a> as shown below.
The trick here is to clean up <code>~/.gradle/caches</code> folder in the very end of a build. Gradle creates some unique nondeterministic
files in <code>~/.gradle/caches</code> folder on every run which makes Cirrus CI re-upload the cache <em>every time</em>. This way, you get faster builds!</p>
<div class="codehilite"><pre><span></span><span class="nt">container</span><span class="p">:</span>
  <span class="nt">image</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">gradle:jdk8</span>

<span class="nt">check_task</span><span class="p">:</span>
  <span class="nt">gradle_cache</span><span class="p">:</span>
    <span class="nt">folder</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">~/.gradle/caches</span>
  <span class="nt">check_script</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">gradle check</span>
  <span class="nt">cleanup_before_cache_script</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">rm -rf ~/.gradle/caches/$GRADLE_VERSION/</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">rm -rf ~/.gradle/caches/transforms-1</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">rm -rf ~/.gradle/caches/journal-1</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">find ~/.gradle/caches/ -name &quot;*.lock&quot; -type f -delete</span>
</pre></div>

<h3 id="build-cache">Build Cache<a class="headerlink" href="#build-cache" title="Permanent link">&para;</a></h3>
<p>Here is how <a href="../guide/writing-tasks/#http-cache">HTTP Cache</a> can be used with Gradle simply by adding following lines to <code>settings.gradle</code>:</p>
<div class="codehilite"><pre><span></span><span class="n">ext</span><span class="o">.</span><span class="na">isCiServer</span> <span class="o">=</span> <span class="n">System</span><span class="o">.</span><span class="na">getenv</span><span class="o">().</span><span class="na">containsKey</span><span class="o">(</span><span class="s2">&quot;CIRRUS_CI&quot;</span><span class="o">)</span>
<span class="n">ext</span><span class="o">.</span><span class="na">isMasterBranch</span> <span class="o">=</span> <span class="n">System</span><span class="o">.</span><span class="na">getenv</span><span class="o">()[</span><span class="s2">&quot;CIRRUS_BRANCH&quot;</span><span class="o">]</span> <span class="o">==</span> <span class="s2">&quot;master&quot;</span>

<span class="n">buildCache</span> <span class="o">{</span>
  <span class="n">local</span> <span class="o">{</span>
    <span class="n">enabled</span> <span class="o">=</span> <span class="o">!</span><span class="n">isCiServer</span>
  <span class="o">}</span>
  <span class="n">remote</span><span class="o">(</span><span class="n">HttpBuildCache</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;http://&#39;</span> <span class="o">+</span> <span class="n">System</span><span class="o">.</span><span class="na">getenv</span><span class="o">().</span><span class="na">getOrDefault</span><span class="o">(</span><span class="s2">&quot;CIRRUS_HTTP_CACHE_HOST&quot;</span><span class="o">,</span> <span class="s2">&quot;localhost:12321&quot;</span><span class="o">)</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span>
    <span class="n">enabled</span> <span class="o">=</span> <span class="n">isCiServer</span>
    <span class="n">push</span> <span class="o">=</span> <span class="n">isMasterBranch</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>

<p>Please make sure you are running Gradle commands with <code>--build-cache</code> flag or have <code>org.gradle.caching</code> enabled in <code>gradle.properties</code> file.
Here is an example of a <code>gradle.properties</code> file that we use internally for all Gradle projects:</p>
<div class="codehilite"><pre><span></span><span class="na">org.gradle.daemon</span><span class="o">=</span><span class="s">true</span>
<span class="na">org.gradle.caching</span><span class="o">=</span><span class="s">true</span>
<span class="na">org.gradle.parallel</span><span class="o">=</span><span class="s">true</span>
<span class="na">org.gradle.configureondemand</span><span class="o">=</span><span class="s">true</span>
<span class="na">org.gradle.jvmargs</span><span class="o">=</span><span class="s">-Dfile.encoding=UTF-8</span>
</pre></div>

<h2 id="junit">JUnit<a class="headerlink" href="#junit" title="Permanent link">&para;</a></h2>
<p>Here is a <code>.cirrus.yml</code> that (once succeeded or failed), parses and uploads JUnit reports:</p>
<div class="codehilite"><pre><span></span><span class="nt">junit_test_task</span><span class="p">:</span>
  <span class="nt">junit_script</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">&lt;replace this comment with instructions to run the test suites&gt;</span>
  <span class="nt">always</span><span class="p">:</span>
    <span class="nt">junit_result_artifacts</span><span class="p">:</span>
      <span class="nt">path</span><span class="p">:</span> <span class="s">&quot;**/test-results/**/*.xml&quot;</span>
      <span class="nt">format</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">junit</span>
      <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">text/xml</span>
</pre></div>

<p>If it is running on a pull request, annotations will also be displayed in-line.</p>
<h2 id="maven">Maven<a class="headerlink" href="#maven" title="Permanent link">&para;</a></h2>
<p>Official <a href="https://hub.docker.com/_/maven/">Maven Docker images</a> can be used for building and testing Maven projects:</p>
<div class="codehilite"><pre><span></span><span class="nt">task</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Cirrus CI</span>
  <span class="nt">container</span><span class="p">:</span>
    <span class="nt">image</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">maven:latest</span>
  <span class="nt">maven_cache</span><span class="p">:</span>
    <span class="nt">folder</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">~/.m2</span>
  <span class="nt">test_script</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">mvn test -B</span>
</pre></div>

<h2 id="mysql">MySQL<a class="headerlink" href="#mysql" title="Permanent link">&para;</a></h2>
<p>The <a href="../guide/writing-tasks/#additional-containers">Additional Containers feature</a> makes it super simple to run the same Docker
MySQL image as you might be running in production for your application. Getting a running instance of the latest GA 
version of MySQL can be as simple as the following six lines in your <code>.cirrus.yml</code>:</p>
<div class="codehilite"><pre><span></span><span class="nt">container</span><span class="p">:</span>
  <span class="nt">image</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">golang:latest</span>
<span class="hll">  <span class="nt">additional_containers</span><span class="p">:</span>
</span><span class="hll">    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">mysql</span>
</span><span class="hll">      <span class="nt">image</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">mysql:latest</span>
</span><span class="hll">      <span class="nt">port</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">3306</span>
</span><span class="hll">      <span class="nt">env</span><span class="p">:</span>
</span><span class="hll">        <span class="nt">MYSQL_ROOT_PASSWORD</span><span class="p">:</span> <span class="s">&quot;&quot;</span>
</span></pre></div>

<p>With the configuration above MySQL will be available on <code>localhost:3306</code>. Use empty password to login as <code>root</code> user. </p>
<h2 id="node">Node<a class="headerlink" href="#node" title="Permanent link">&para;</a></h2>
<p>Official <a href="https://hub.docker.com/_/node/">NodeJS Docker images</a> can be used for building and testing Node.JS applications.</p>
<h3 id="npm">npm<a class="headerlink" href="#npm" title="Permanent link">&para;</a></h3>
<p>Here is an example of a <code>.cirrus.yml</code> that caches <code>node_modules</code> based on contents of <code>package-lock.json</code> file and runs tests:</p>
<div class="codehilite"><pre><span></span><span class="nt">container</span><span class="p">:</span>
  <span class="nt">image</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">node:latest</span>

<span class="nt">test_task</span><span class="p">:</span>
  <span class="nt">node_modules_cache</span><span class="p">:</span>
    <span class="nt">folder</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">node_modules</span>
    <span class="nt">fingerprint_script</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">cat package-lock.json</span>
    <span class="nt">populate_script</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">npm ci</span>
  <span class="nt">test_script</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">npm test</span>
</pre></div>

<h3 id="yarn">Yarn<a class="headerlink" href="#yarn" title="Permanent link">&para;</a></h3>
<p>Here is an example of a <code>.cirrus.yml</code> that caches <code>node_modules</code> based on the contents of a <code>yarn.lock</code> file and runs tests:</p>
<div class="codehilite"><pre><span></span><span class="nt">container</span><span class="p">:</span>
  <span class="nt">image</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">node:latest</span>

<span class="nt">test_task</span><span class="p">:</span>
  <span class="nt">node_modules_cache</span><span class="p">:</span>
    <span class="nt">folder</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">node_modules</span>
    <span class="nt">fingerprint_script</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">cat yarn.lock</span>
    <span class="nt">populate_script</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">yarn install</span>
  <span class="nt">test_script</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">yarn run test</span>
</pre></div>

<h2 id="python">Python<a class="headerlink" href="#python" title="Permanent link">&para;</a></h2>
<p>Official <a href="https://hub.docker.com/_/python/">Python Docker images</a> can be used for builds. Here is an example of a <code>.cirrus.yml</code> 
that caches installed packages based on contents of <code>requirements.txt</code> and runs <code>pytest</code>:</p>
<div class="codehilite"><pre><span></span><span class="nt">container</span><span class="p">:</span>
  <span class="nt">image</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">python:slim</span>

<span class="nt">test_task</span><span class="p">:</span>
  <span class="nt">pip_cache</span><span class="p">:</span>
    <span class="nt">folder</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">~/.cache/pip</span>
    <span class="nt">fingerprint_script</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">echo $PYTHON_VERSION &amp;&amp; cat requirements.txt</span>
    <span class="nt">populate_script</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">pip install -r requirements.txt</span>
  <span class="nt">test_script</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">pytest</span>
</pre></div>

<h3 id="building-pypi-packages">Building PyPI Packages<a class="headerlink" href="#building-pypi-packages" title="Permanent link">&para;</a></h3>
<p>Also using the Python Docker images, you can run tests if you are making packages for <a href="https://pypi.org">PyPI</a>. Here is an example <code>.cirrus.yml</code> for doing so:</p>
<div class="codehilite"><pre><span></span><span class="nt">container</span><span class="p">:</span>
  <span class="nt">image</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">python:slim</span>

<span class="nt">build_package_test_task</span><span class="p">:</span>
  <span class="nt">pip_cache</span><span class="p">:</span>
    <span class="nt">folder</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">~/.cache/pip</span>
    <span class="nt">fingerprint_script</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">echo $PYTHON_VERSION</span>
    <span class="nt">populate_script</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">python3 -m pip install --upgrade setuptools wheel</span>
  <span class="nt">build_package_test_script</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">python3 setup.py sdist bdist_wheel</span>
</pre></div>

<h3 id="linting">Linting<a class="headerlink" href="#linting" title="Permanent link">&para;</a></h3>
<p>You can easily set up linting with Cirrus CI and flake8, here is an example <code>.cirrus.yml</code>:</p>
<div class="codehilite"><pre><span></span><span class="nt">lint_task</span><span class="p">:</span>
  <span class="nt">container</span><span class="p">:</span>
    <span class="nt">image</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">alpine/flake8:latest</span>
  <span class="nt">script</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">flake8 *.py</span>
</pre></div>

<h3 id="unittest-annotations"><code>Unittest</code> Annotations<a class="headerlink" href="#unittest-annotations" title="Permanent link">&para;</a></h3>
<p>Python Unittest reports are supported by <a href="https://medium.com/cirruslabs/github-annotations-support-227d179cde31">Cirrus CI Annotations</a>.
This way you can see what tests are failing without leaving the pull request you are reviewing! Here is an example
of a <code>.cirrus.yml</code> that produces and stores <code>Unittest</code> reports:</p>
<div class="codehilite"><pre><span></span><span class="nt">unittest_task</span><span class="p">:</span>
  <span class="nt">container</span><span class="p">:</span>
    <span class="nt">image</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">python:slim</span>
  <span class="nt">install_dependencies_script</span><span class="p">:</span> <span class="p p-Indicator">|</span>
    <span class="no">pip3 install unittest_xml_reporting</span>
  <span class="nt">run_tests_script</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">python3 -m xmlrunner tests</span>
  <span class="c1"># replace &#39;tests&#39; with the module,</span>
  <span class="c1"># unittest.TestCase, or unittest.TestSuite</span>
  <span class="c1"># that the tests are in</span>
  <span class="nt">always</span><span class="p">:</span>
    <span class="nt">upload_results_artifacts</span><span class="p">:</span>
      <span class="nt">path</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">./*.xml</span>
      <span class="nt">format</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">junit</span>
      <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">text/xml</span>
</pre></div>

<p>Now you should get annotations for your test results.</p>
<h2 id="release-assets">Release Assets<a class="headerlink" href="#release-assets" title="Permanent link">&para;</a></h2>
<p>Cirrus CI doesn't provide a built-in functionality to upload artifacts on a GitHub release but this functionality can be
added via a simple script. For a release Cirrus CI will provide <code>CIRRUS_RELEASE</code> environment variable along with <code>CIRRUS_TAG</code> 
environment variable. <code>CIRRUS_RELEASE</code> indicates release id which can be used to upload assets.</p>
<p>Cirrus CI only requires write access to Check API and doesn't require write access to repository contents because of security 
reasons. That's why you need to <a href="https://github.com/settings/tokens/new">create a personal access token</a> with full access
to <code>repo</code> scope. Once an access token is created, please <a href="../guide/writing-tasks/#encrypted-variables">create an encrypted variable</a> 
from it and save it to <code>.cirrus.yml</code>:</p>
<div class="codehilite"><pre><span></span><span class="nt">env</span><span class="p">:</span>
  <span class="nt">GITHUB_TOKEN</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ENCRYPTED[qwerty]</span>
</pre></div>

<p>Now you can use a simple script to upload your assets:</p>
<div class="codehilite"><pre><span></span><span class="ch">#!/usr/bin/env bash</span>

<span class="k">if</span> <span class="o">[[</span> <span class="s2">&quot;</span><span class="nv">$CIRRUS_RELEASE</span><span class="s2">&quot;</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span> <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>
  <span class="nb">echo</span> <span class="s2">&quot;Not a release. No need to deploy!&quot;</span>
  <span class="nb">exit</span> <span class="m">0</span>
<span class="k">fi</span>

<span class="k">if</span> <span class="o">[[</span> <span class="s2">&quot;</span><span class="nv">$GITHUB_TOKEN</span><span class="s2">&quot;</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span> <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>
  <span class="nb">echo</span> <span class="s2">&quot;Please provide GitHub access token via GITHUB_TOKEN environment variable!&quot;</span>
  <span class="nb">exit</span> <span class="m">1</span>
<span class="k">fi</span>

<span class="nv">file_content_type</span><span class="o">=</span><span class="s2">&quot;application/octet-stream&quot;</span>
<span class="nv">files_to_upload</span><span class="o">=(</span>
  <span class="c1"># relative paths of assets to upload</span>
<span class="o">)</span>

<span class="k">for</span> fpath in <span class="nv">$files_to_upload</span>
<span class="k">do</span>
  <span class="nb">echo</span> <span class="s2">&quot;Uploading </span><span class="nv">$fpath</span><span class="s2">...&quot;</span>
  <span class="nv">name</span><span class="o">=</span><span class="k">$(</span>basename <span class="s2">&quot;</span><span class="nv">$fpath</span><span class="s2">&quot;</span><span class="k">)</span>
  <span class="nv">url_to_upload</span><span class="o">=</span><span class="s2">&quot;https://uploads.github.com/repos/</span><span class="nv">$CIRRUS_REPO_FULL_NAME</span><span class="s2">/releases/</span><span class="nv">$CIRRUS_RELEASE</span><span class="s2">/assets?name=</span><span class="nv">$name</span><span class="s2">&quot;</span>
  curl -X POST <span class="se">\</span>
    --data-binary @<span class="nv">$fpath</span> <span class="se">\</span>
    --header <span class="s2">&quot;Authorization: token </span><span class="nv">$GITHUB_TOKEN</span><span class="s2">&quot;</span> <span class="se">\</span>
    --header <span class="s2">&quot;Content-Type: </span><span class="nv">$file_content_type</span><span class="s2">&quot;</span> <span class="se">\</span>
    <span class="nv">$url_to_upload</span>
<span class="k">done</span>
</pre></div>

<h2 id="ruby">Ruby<a class="headerlink" href="#ruby" title="Permanent link">&para;</a></h2>
<p>Official <a href="https://hub.docker.com/_/ruby/">Ruby Docker images</a> can be used for builds. Here is an example of a <code>.cirrus.yml</code> 
that caches installed gems based on contents of <code>Gemfile.lock</code> and runs <code>rspec</code>:</p>
<div class="codehilite"><pre><span></span><span class="nt">container</span><span class="p">:</span>
  <span class="nt">image</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ruby:latest</span>

<span class="nt">rspec_task</span><span class="p">:</span>
  <span class="nt">install_bundler_script</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">gem install bundler</span>
  <span class="nt">bundle_cache</span><span class="p">:</span>
    <span class="nt">folder</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/usr/local/bundle</span>
    <span class="nt">fingerprint_script</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">echo $RUBY_VERSION &amp;&amp; cat Gemfile &amp;&amp; cat Gemfile.lock</span>
    <span class="nt">populate_script</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">bundle install</span>
  <span class="nt">rspec_script</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">bundle exec rspec</span>
</pre></div>

<div class="admonition tip">
<p class="admonition-title">Test Parallelization</p>
<p>It's super easy to add intelligent test splitting by using <a href="https://knapsackpro.com/">Knapsack Pro</a> and <a href="../guide/writing-tasks/#matrix-modification">matrix modification</a>.
After <a href="https://docs.knapsackpro.com/knapsack_pro-ruby/guide/">setting up Knapsack Pro gem</a> simply add sharding like this:</p>
<div class="codehilite"><pre><span></span><span class="nt">task</span><span class="p">:</span>
  <span class="nt">matrix</span><span class="p">:</span>
    <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">rspec (shard 1)</span>
    <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">rspec (shard 2)</span>
    <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">rspec (shard 3)</span>
    <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">rspec (shard 4)</span>
  <span class="nt">bundle_cache</span><span class="p">:</span>
    <span class="nt">folder</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/usr/local/bundle</span>
    <span class="nt">fingerprint_script</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">cat Gemfile.lock</span>
    <span class="nt">populate_script</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">bundle install</span>
  <span class="nt">rspec_script</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">bundle exec rake knapsack_pro:rspec</span>
</pre></div>

<p>Which will create four shards that will theoretically <strong>run tests 4x faster</strong> by equaly splitting all tests between 
these four shards.</p>
</div>
<h2 id="rust">Rust<a class="headerlink" href="#rust" title="Permanent link">&para;</a></h2>
<p>Official <a href="https://hub.docker.com/_/rust/">Rust Docker images</a> can be used for builds. Here is a simple example of <code>.cirrus.yml</code> 
that caches crates in <code>$CARGO_HOME</code> based on contents of <code>Cargo.lock</code>:</p>
<div class="codehilite"><pre><span></span><span class="nt">container</span><span class="p">:</span>
  <span class="nt">image</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">rust:latest</span>

<span class="nt">test_task</span><span class="p">:</span>
  <span class="nt">cargo_cache</span><span class="p">:</span>
    <span class="nt">folder</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">$CARGO_HOME/registry</span>
    <span class="nt">fingerprint_script</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">cat Cargo.lock</span>
  <span class="nt">build_script</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">cargo build</span>
  <span class="nt">test_script</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">cargo test</span>
  <span class="nt">before_cache_script</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">rm -rf $CARGO_HOME/registry/index</span>
</pre></div>

<div class="admonition tip">
<p class="admonition-title">Caching Cleanup</p>
<p>Please note <code>before_cache_script</code> that removes registry index from the cache before uploading it in the end of a successful task. 
Registry index is <a href="https://github.com/rust-lang/crates.io-index">changing very rapidly</a> making the cache invalid. <code>before_cache_script</code>
deletes the index and leaves just the required crates for caching.</p>
</div>
<h3 id="rust-nightly">Rust Nightly<a class="headerlink" href="#rust-nightly" title="Permanent link">&para;</a></h3>
<p>It is possible to use nightly builds of Rust via an <a href="https://hub.docker.com/r/rustlang/rust/">official <code>rustlang/rust:nightly</code> container</a>. 
Here is an example of a <code>.cirrus.yml</code> to run tests against the latest stable and nightly versions of Rust:</p>
<div class="codehilite"><pre><span></span><span class="nt">test_task</span><span class="p">:</span>
  <span class="nt">matrix</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">container</span><span class="p">:</span>
        <span class="nt">image</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">rust:latest</span>
    <span class="p p-Indicator">-</span> <span class="nt">allow_failures</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
      <span class="nt">container</span><span class="p">:</span>
        <span class="nt">image</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">rustlang/rust:nightly</span>
  <span class="nt">cargo_cache</span><span class="p">:</span>
    <span class="nt">folder</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">$CARGO_HOME/registry</span>
    <span class="nt">fingerprint_script</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">cat Cargo.lock</span>
  <span class="nt">build_script</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">cargo build</span>
  <span class="nt">test_script</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">cargo test</span>
  <span class="nt">before_cache_script</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">rm -rf $CARGO_HOME/registry/index</span>
</pre></div>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
  <div class="md-footer-nav">
    <nav class="md-footer-nav__inner md-grid">
      
      <a href="/security/" title="Security" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
        <div class="md-flex__cell md-flex__cell--shrink">
          <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
        </div>
        <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Security
              </span>
        </div>
      </a>
      
      
      <a href="/pricing/" title="Pricing" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
        <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Pricing
              </span>
        </div>
        <div class="md-flex__cell md-flex__cell--shrink">
          <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
        </div>
      </a>
      
    </nav>
  </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        <div class="md-footer-copyright__highlight">
           Cirrus Labs 2017-present
        </div>
        
      </div>
      
      
  <div class="md-footer-social">
    <link rel="stylesheet" href="../assets/fonts/font-awesome.css">
    
      <a href="https://github.com/cirruslabs" class="md-footer-social__link fa fa-github"></a>
    
      <a href="https://twitter.com/cirrus_labs" class="md-footer-social__link fa fa-twitter"></a>
    
  </div>

      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.a8b5e56f.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:".."}})</script>
      
    
  </body>
</html>